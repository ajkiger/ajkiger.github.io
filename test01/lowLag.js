if(!window.console)console={log:function(){}};var lowLag=new function(){this.someVariable=undefined;this.showNeedInit=function(){lowLag.msg("lowLag: you must call lowLag.init() first!")};this.load=this.showNeedInit;this.play=this.showNeedInit;this.audioTagTimeToLive=5000;this.sm2url='sm2/swf/';this.soundUrl="";this.debug="console";this.init=function(a){$("#lowLag").remove();$("body").append("<div id='lowLag'></div>");var b=undefined;if(a!==undefined){if(a['force']!==undefined){b=a['force']}if(a['audioTagTimeToLive']!==undefined){lowLag.audioTagTimeToLive=a['audioTagTimeToLive']}if(a['sm2url']!==undefined){lowLag.sm2url=a['sm2url']}if(a['urlPrefix']!==undefined){lowLag.soundUrl=a['urlPrefix']}if(a['debug']!==undefined){lowLag.debug=a['debug']}}var c="sm2";if(b!==undefined)c=b;else{if(typeof(webkitAudioContext)!=="undefined")c='webkitAudio';else if(navigator.userAgent.indexOf("Firefox")!==-1)c='audioTag'}switch(c){case'webkitAudio':this.msg("init webkitAudio");this.load=this.loadSoundWebkitAudio;this.play=this.playSoundWebkitAudio;this.webkitAudioContext=new webkitAudioContext();break;case'audioTag':this.msg("init audioTag");this.load=this.loadSoundAudioTag;this.play=this.playSoundAudioTag;break;case'sm2':this.msg("init SoundManager2");this.load=this.loadSoundSM2;this.play=this.playSoundSM2;lowLag.msg("loading SM2 from "+lowLag.sm2url);soundManager.setup({url:lowLag.sm2url,useHighPerformance:true,onready:lowLag.sm2Ready,debugMode:true});break}};this.sm2IsReady=false;this.sm2ToLoad=[];this.loadSoundSM2=function(a,b){if(lowLag.sm2IsReady){lowLag.loadSoundSM2ForReals(a,b)}else{lowLag.sm2ToLoad.push([a,b])}};this.loadSoundSM2ForReals=function(a,b){var c=lowLag.getTagFromURL(a,b);lowLag.msg('sm2 loading '+a+' as tag '+c);var a=lowLag.getURLArray(a);for(var i=0;i<a.length;i++){var d=lowLag.soundUrl+a[i];a[i]=d}soundManager.createSound({id:c,autoLoad:true,url:a})};this.sm2Ready=function(){lowLag.sm2IsReady=true;for(var i=0;i<lowLag.sm2ToLoad.length;i++){var a=lowLag.sm2ToLoad[i];lowLag.loadSoundSM2ForReals(a[0],a[1])}lowLag.sm2ToLoad=[]};this.playSoundSM2=function(a){lowLag.msg("playSoundSM2 "+a);soundManager.play(a)};this.getTagFromURL=function(a,b){if(b!==undefined)return b;return lowLag.getSingleURL(a)};this.getSingleURL=function(a){if(typeof(a)==="string")return a;return a[0]};this.getURLArray=function(a){if(typeof(a)==="string")return[a];return a};this.webkitPendingRequest={};this.webkitAudioContext=undefined;this.webkitAudioBuffers={};this.loadSoundWebkitAudio=function(b,c){var d=lowLag.getSingleURL(b);var c=lowLag.getTagFromURL(b,c);lowLag.msg('webkitAudio loading '+d+' as tag '+c);var e=new XMLHttpRequest();e.open('GET',lowLag.soundUrl+d,true);e.responseType='arraybuffer';e.onload=function(){lowLag.webkitAudioContext.decodeAudioData(e.response,function(a){lowLag.webkitAudioBuffers[c]=a;if(lowLag.webkitPendingRequest[c]){lowLag.playSoundWebkitAudio(c)}},lowLag.errorLoadWebkitAudtioFile)};e.send()};this.errorLoadWebkitAudtioFile=function(e){lowLag.msg("Error loading webkitAudio: "+e)};this.playSoundWebkitAudio=function(a){lowLag.msg("playSoundWebkitAudio "+a);var b=lowLag.webkitAudioBuffers[a];if(b===undefined){lowLag.webkitPendingRequest[a]=true;return}var c=lowLag.webkitAudioContext;var d=c.createBufferSource();d.buffer=b;d.connect(c.destination);d.noteOn(0)};this.audioTagID=0;this.audioTagNameToElement={};this.loadSoundAudioTag=function(a,b){var c="lowLagElem_"+lowLag.audioTagID++;var b=lowLag.getTagFromURL(a,b);var a=lowLag.getURLArray(a);lowLag.audioTagNameToElement[b]=c;lowLag.msg('audioTag loading '+a+' as tag '+b);var d="";d+='<audio id="'+c+'" preload="auto" autobuffer>';for(var i=0;i<a.length;i++){var e=a[i];var f="audio/"+lowLag.getExtension(e);d+='  <source src="'+lowLag.soundUrl+e+'" type="'+f+'" />'}d+='</audio>';$("#lowLag").append(d)};this.playSoundAudioTag=function(a){lowLag.msg("playSoundAudioTag "+a);var b=lowLag.audioTagNameToElement[a];var c="lowLagCloneElem_"+lowLag.audioTagID++;$('#'+b).clone().attr('id',c).appendTo('#lowLag');var d=document.getElementById(c);lowLag.msg(a);if(lowLag.audioTagTimeToLive!==-1){setTimeout(function(){$('#'+c).remove()},lowLag.audioTagTimeToLive)}d.play()};this.getExtension=function(a){return a.substring(a.lastIndexOf(".")+1).toLowerCase()};this.msg=function(m){m="-- lowLag "+m;if(lowLag.debug==='both'||lowLag.debug==='console'){console.log(m+"<br>")}if(lowLag.debug==='both'||lowLag.debug==='screen'){$('#lowLag').append(m+"<br>")}}};