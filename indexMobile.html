<html>

<head>
<title>Word Cubed Weekly</title>


<script>
    var browserWidth=window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    
    var tempScale = browserWidth/720;
    tempScale = "initial-scale=" + tempScale + ", maximum-scale=" + tempScale + ", user-scalable=0";
    
    var mvp = document.getElementById('viewport');
    mvp.setAttribute('content',tempScale);
    
</script>
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=0.5, maximum-scale=0.5, user-scalable=0">

<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>

<script type="text/javascript" src="gl-matrix-min.js"></script>
<script type="text/javascript" src="webgl-utils.js"></script>

<script type="text/javascript" src="EAGLView.js"></script>
<script type="text/javascript" src="SceneController.js"></script>
<script type="text/javascript" src="CubeObject.js"></script>
<script type="text/javascript" src="CubeMesh.js"></script>
<script type="text/javascript" src="cube4x4.js"></script>
<script type="text/javascript" src="cube5x5.js"></script>
<script type="text/javascript" src="cube6x6.js"></script>
<script type="text/javascript" src="InputViewController.js"></script>
<script type="text/javascript" src="geometryF.js"></script>
<script type="text/javascript" src="LetterSquareObject.js"></script>
<script type="text/javascript" src="ActiveLetterImage.js"></script>
<script type="text/javascript" src="WordListObject.js"></script>
<script type="text/javascript" src="ParticleSystem.js"></script>
<script type="text/javascript" src="Particle.js"></script>
<script type="text/javascript" src="TableRowObject.js"></script>
<script type="text/javascript" src="FormMenus.js"></script>



<style>
    body {
        
        background-color: #cccccc;
        color: black;
        
        height: 100%;
        overflow: hidden;
        
    }
    
    
    
    #dialogMenu{
        
        width: 640px;
        margin-left: auto;
        margin-right: auto;
        margin-top: 1px;
        margin-bottom: 1px;
        
    }
    
    #container{
        width: 640px;
        height: 640px;
        margin-left: auto;
        margin-right: auto;
        margin-top: 0px;
        margin-bottom: 5px;
        opacity:0.0;
        filter:alpha(opacity=100); /* For IE8 and earlier */
        background-color:  #b3b3b3;
    }
    
    
    
    #wordboxcontainer{
        
        width: 630px;
        height: 85px;
        
        margin-left: auto;
        margin-right: auto;
        margin-top: 2px;
        margin-bottom: 2px;
        
        padding-top: 2px;
        padding-bottom: 2px;
        padding-left: 5px;
        padding-right: 5px;
        
        //float: bottom;
        //float: none;
        overflow-y: hidden;
        
        font-family: arial, Helvetica, sans-serif;
        font-size:  24px; 
        font-weight:  500;// bold;
        background-color:  #b3b3b3;    
        
    }
    
    #wordbox{
        margin-top: 0px;
        margin-bottom: 0px;
        
    }
    
    
    
    #btncontainer{
        width: 640px;
        height: 35px;
        margin-left: auto;
        margin-right: auto;
        
    }
    
    #btnhints {
        width: 55px;
        height: 45px;
        margin-left: 185px;
    }
    
    #btnsettings{
        width: 55px;
        height: 45px;
    }
    
    #btngames{
        width: 55px;
        height: 45px;
    }
    
    #btninfo{
        width: 55px;
        height: 45px;
    }
    
    
    
    #starbox {
        margin-top: 2px;
        margin-left: 50px;
        vertical-align:bottom;
    }
    
    #namebox{
        font-family: arial, Helvetica, sans-serif;
        font-size:  22px; 
        font-weight:  500;// bold;
        
    }
    
    #scoreratebox{
        font-family: arial, Helvetica, sans-serif;
        font-size:  32px; 
        font-weight:  700;// bold;
        margin-left: 215px;
        text-align: right;
    }
    
    #scorebox{
        
        font-family: arial, Helvetica, sans-serif;
        font-size:  32px; 
        font-weight:  700;// bold;
        margin-left : 150px;
        text-align: right;
    }
    
    div#weekly-games { width: 550px; margin: 20px 0; }
    div#weekly-games table { margin: 1em 0; border-collapse: collapse; width: 100%; }
    div#weekly-games table td, div#weekly-games table th { border: 1px solid #eee; padding: .6em 10px; text-align: center; }
    
    div#weekly-games table tbody tr:hover {
    background-color: #cccccc;
    cursor: pointer;
    
    
}
    
    
    
</style>

<script id="shader-fs" type="x-shader/x-fragment">
    precision mediump float;

    varying vec4 vColor;
    varying vec2 vTextureCoord;
    varying vec3 vLightWeighting;
    
    uniform float uAlpha;
    
    uniform sampler2D uSampler;
    
    
    void main(void) {
        vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
        gl_FragColor = vec4(textureColor.rgb * vLightWeighting.rgb * vColor.rgb, textureColor.a * uAlpha); // * vColor.rgb
  }
</script>

<script id="shader-vs" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec4 aVertexColor;
    attribute vec3 aVertexNormal;
    attribute vec2 aTextureCoord;
    
    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;
    uniform mat3 uNMatrix;
    
    uniform float uRAngle;
    uniform float xUmin;
    uniform float xVmin;

    uniform vec3 uLightPosition;
    uniform vec3 uAmbientLightColor;
    uniform vec3 uDiffuseLightColor;
    uniform vec3 uSpecularLightColor;

    varying vec4 vColor;
    varying vec2 vTextureCoord;
    varying vec3 vLightWeighting;
    
    const float shininess = 32.0;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vTextureCoord = vec2(((aTextureCoord.x - 0.5) * cos(uRAngle) - (aTextureCoord.y  - 0.5) * sin(uRAngle)) + 0.5, ((aTextureCoord.x - 0.5) * sin(uRAngle) + (aTextureCoord.y - 0.5) * cos(uRAngle)) + 0.5);
        //vTextureCoord = vec2(((aTextureCoord.x - (xUmin + 0.0625)) * cos(uRAngle) - (aTextureCoord.y  - (xVmin + 0.0625)) * sin(uRAngle)) + xUmin + 0.0625, ((aTextureCoord.x - (xUmin + 0.0625)) * sin(uRAngle) + (aTextureCoord.y - (xVmin + 0.0625)) * cos(uRAngle)) + xVmin + 0.0625);
        vColor = aVertexColor;

        vec4 vertexPositionEye4 = uMVMatrix * vec4(aVertexPosition, 1.0);
        vec3 vertexPositionEye3 = vertexPositionEye4.xyz / vertexPositionEye4.w;

        vec3 vectorToLightSource = normalize(uLightPosition - vertexPositionEye3);

        vec3 normalEye = normalize(uNMatrix * aVertexNormal);

        float diffuseLightWeighting = max(dot(normalEye, vectorToLightSource), 0.0);

        vec3 reflectionVector = normalize(reflect(-vectorToLightSource, normalEye));

        vec3 viewVectorEye = -normalize(vertexPositionEye3);

        float rdotv = max(dot(reflectionVector, viewVectorEye), 0.0);

        float specularLightWeighting = pow(rdotv, shininess);

        vLightWeighting = uAmbientLightColor + uDiffuseLightColor * diffuseLightWeighting + uSpecularLightColor * specularLightWeighting;
    }
</script>


<script type="text/javascript">

    var gl;
    var canvas;

    function initGL(canvas) {
        
        gl = WebGLUtils.setupWebGL(canvas);
        if (!gl) {
            //alert("Could not initialise WebGL, sorry :-(");
            $( "#container" ).fadeTo(400, 1.0);
            return;
        }
        gl.viewportWidth = canvas.width;
        gl.viewportHeight = canvas.height;
        
    }


    function getShader(gl, id) {
        var shaderScript = document.getElementById(id);
        if (!shaderScript) {
            return null;
        }

        var str = "";
        var k = shaderScript.firstChild;
        while (k) {
            if (k.nodeType === 3) {
                str += k.textContent;
            }
            k = k.nextSibling;
        }

        var shader;
        if (shaderScript.type === "x-shader/x-fragment") {
            shader = gl.createShader(gl.FRAGMENT_SHADER);
        } else if (shaderScript.type === "x-shader/x-vertex") {
            shader = gl.createShader(gl.VERTEX_SHADER);
        } else {
            return null;
        }

        gl.shaderSource(shader, str);
        gl.compileShader(shader);

        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
            alert(gl.getShaderInfoLog(shader));
            return null;
        }

        return shader;
    }


    var shaderProgram;

    function initShaders() {
        var fragmentShader = getShader(gl, "shader-fs");
        var vertexShader = getShader(gl, "shader-vs");

        shaderProgram = gl.createProgram();
        gl.attachShader(shaderProgram, vertexShader);
        gl.attachShader(shaderProgram, fragmentShader);
        gl.linkProgram(shaderProgram);

        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
            alert("Could not initialise shaders");
        }

        gl.useProgram(shaderProgram);

        shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, "aVertexPosition");
        gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);

        shaderProgram.vertexColorAttribute = gl.getAttribLocation(shaderProgram, "aVertexColor");
        gl.enableVertexAttribArray(shaderProgram.vertexColorAttribute);
        
        shaderProgram.vertexNormalAttribute = gl.getAttribLocation(shaderProgram, "aVertexNormal");
        gl.enableVertexAttribArray(shaderProgram.vertexNormalAttribute);
        
        shaderProgram.textureCoordAttribute = gl.getAttribLocation(shaderProgram, "aTextureCoord");
        gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute);
        
        shaderProgram.pMatrixUniform = gl.getUniformLocation(shaderProgram, "uPMatrix");
        shaderProgram.mvMatrixUniform = gl.getUniformLocation(shaderProgram, "uMVMatrix");
        shaderProgram.nMatrixUniform = gl.getUniformLocation(shaderProgram, "uNMatrix");
        shaderProgram.samplerUniform = gl.getUniformLocation(shaderProgram, "uSampler");
        
        shaderProgram.lightPositionUniform = gl.getUniformLocation(shaderProgram, "uLightPosition");
        shaderProgram.ambientLightColorUniform = gl.getUniformLocation(shaderProgram, "uAmbientLightColor");
        shaderProgram.diffuseLightColorUniform = gl.getUniformLocation(shaderProgram, "uDiffuseLightColor");
        shaderProgram.specularLightColorUniform = gl.getUniformLocation(shaderProgram, "uSpecularLightColor");
        
        shaderProgram.alphaUniform = gl.getUniformLocation(shaderProgram, "uAlpha");
        shaderProgram.rAngleUniform = gl.getUniformLocation(shaderProgram, "uRAngle");
        shaderProgram.xUminUniform = gl.getUniformLocation(shaderProgram, "xUmin");
        shaderProgram.xVminUniform = gl.getUniformLocation(shaderProgram, "xVmin");
    }




    var mvMatrix = mat4.create();
    var mvMatrixStack = [];
    var pMatrix = mat4.create();
    

    function mvPushMatrix() {
        var copyM = mat4.create();
        mat4.copy(copyM, mvMatrix);
        mvMatrixStack.push(copyM);
    }

    function mvPopMatrix() {
        if (mvMatrixStack.length === 0) {
            throw "Invalid popMatrix!";
        }
        mvMatrix = mvMatrixStack.pop();
    }


    function setMatrixUniforms() {
        gl.uniformMatrix4fv(shaderProgram.pMatrixUniform, false, pMatrix);
        gl.uniformMatrix4fv(shaderProgram.mvMatrixUniform, false, mvMatrix);
        
        var normalMatrix = mat3.create();
        mat3.identity(normalMatrix);
        mat3.normalFromMat4(normalMatrix, mvMatrix);
        gl.uniformMatrix3fv(shaderProgram.nMatrixUniform, false, normalMatrix);
    }


    function degToRad(degrees) {
        return degrees * Math.PI / 180;
    }


    var skipFrame = false;
    var elapsedTime = 0;
    var frameCount = 0;
    var lastTime = new Date().getTime();
    function GameLoop() {  //Game Loop
        window.requestAnimFrame(GameLoop, canvas);
        
        if (skipFrame){
            skipFrame = false;
            
        }
        else{
            skipFrame = true;
            
            SceneControllerUpdateModel();
            
            SceneControllerRenderScene();

            var now = new Date().getTime();

            frameCount++;
            elapsedTime += (now - lastTime);

            lastTime = now;

            if(elapsedTime >= 1000) {
                fps = frameCount;
                frameCount = 0;
                elapsedTime -= 1000;

                //document.getElementById('test').innerHTML = "FPS: " + fps;
            }

            lastTime = new Date().getTime();
            
        }
        
        
    }

    var startTimer;
    function webGLStart() {
        
        canvas = document.getElementById("WordCubed-canvas");
        
        initGL(canvas);
        initShaders();
        initContext();
        //$( "#container" ).fadeTo(400, 1.0);
        
        canvas.onmousedown = handleMouseDownonCanvas;
        canvas.onmousemove = handleMouseMoveonCanvas;
        canvas.onmouseup = handleMouseUponCanvas;
        //canvas.ondblclick = handleMouseDblClickonCanvas;
        canvas.onmouseout = handleMouseOutonCanvas;
        
        
        var checks = $( "#settingsformat" ).buttonset();
        $( "#dialogSettings" ).empty().append(checks);
        
        sceneController = new Object();
        sceneControllerInit();
        sceneControllerLoadScene();
        
        
        
        startTimer = setTimeout(function(){GameLoop();}, 1500);
        
    }
    
    $(document).bind(
            'touchmove',
            function(e) {
              e.preventDefault();
            }
         );
    
    /*
    $("#container").on({
        "touchmove" : function(e){ e.preventDefault(); }
    });
    */
    
    $(function() {
        $( "#container" ).dblclick(function(e) {
              handleMouseDblClickonCanvas(e);
            });
    });
    /*
    $(function() {
        $( document ).tooltip();
    });
    */
   
    $(function() {
        $( "#dialog" ).dialog({
          autoOpen: false,
          height: 580,
          width: 620,
          //modal: true,
          draggable: false,
          resizable: false,
          buttons: {
            Close: function() {
              $( this ).dialog( "close" );
            }
          },
          position: {
              my: "top",
              at: "top",
              of: container
          },
          show: {
            effect: "fade",
            duration: 200
          },
          hide: {
            effect: "fade",
            duration: 200
          }
        });
        
        $( "#btninfo" ).click(function() {  //"#btninfo"
          var tabs = $("#tabs");
          $( "#dialog" ).empty().append(tabs);
          $( "#dialog" ).dialog( "open" );
          tabs.show();
          tabs.tabs();
        });
        
    });
    
    $(function() {
        $( "#dialogHints" ).dialog({
          autoOpen: false,
          height: 170,
          width: 240,
          //modal: true,
          draggable: false,
          resizable: false,
          buttons: {
            "Take a Hint": function() {
              showHint();
              $( this ).dialog( "close" );
            },
            "Solve Cube": function() {
              SolveTheCube();
              $( this ).dialog( "close" );
            }
          },
          position: {
              my: "left top",
              at: "left top",
              of: container
          },
          show: {
            effect: "fade",
            duration: 200
          },
          hide: {
            effect: "fade",
            duration: 200
          }
        });
        
        $( "#btnhints" ).click(function() {
          $( "#dialogHints" ).empty();
          $( "#dialogHints" ).dialog( "open" );
          if(sceneController.wordHintWords.length > 0){
              $(":button:contains('Take a Hint')").attr("disabled","disabled").addClass( 'ui-state-disabled' );
          }
          else
          {
              $(":button:contains('Take a Hint')").removeAttr('disabled').removeClass( 'ui-state-disabled' );
          }
          if(sceneController.solveCube){
              $(":button:contains('Take a Hint')").removeAttr('disabled').removeClass( 'ui-state-disabled' );
          }
        });
        
    });
    
    $(function() {
        $( "#dialogSettings" ).dialog({
          autoOpen: false,
          height: 200,
          width: 240,
          //modal: true,
          draggable: false,
          resizable: false,
          buttons: {
            "New Game": function() {
             if($('#check1').prop('checked')){
                 sceneController.maxWordKey = "High Word Density";
             }
             else
             {
                 sceneController.maxWordKey = "Low Word Density";
             }
             if($('#check2').prop('checked')){
                 sceneController.cubeColorKey = "Inverse";
             }
             else
             {
                 sceneController.cubeColorKey = "Normal";
             }
             
             sceneController.endAnimationActive = true;
              $( this ).dialog( "close" );
            }
          },
          position: {
              my: "left top",
              at: "left top",
              of: container
          },
          show: {
            effect: "fade",
            duration: 200
          },
          hide: {
            effect: "fade",
            duration: 200
          }
        });

        $( "#btnsettings" ).click(function() {
          
          var checks = $( "#settingsformat" ).buttonset();
          $( "#dialogSettings" ).empty().append(checks);
          $( "#dialogSettings" ).dialog( "open" );
          checks.show();
          
        });
    });
    
    $(function() {
        $( "#dialoggames" ).dialog({
          autoOpen: false,
          height: 580,
          width: 620,
          //modal: true,
          draggable: false,
          resizable: false,
          buttons: {
            Close: function() {
              $( this ).dialog( "close" );
            }
          },
          position: {
              my: "top",
              at: "top",
              of: container
          },
          show: {
            effect: "fade",
            duration: 200
          },
          hide: {
            effect: "fade",
            duration: 200
          }
        });

        $( "#btngames" ).click(function() {
          var table = $("#weekly-games");
          $( "#users tbody" ).empty();
          for(var i = 0; i < weeklyWordLists.length; i++){
                var tElement = weeklyWordLists[i];
                if(tElement.date === sceneController.currentGame){
                   $( "#users tbody" ).append( "<tr style=\"background: #ffccff\">" +
                    "<td>" + tElement.date + "</td>" +
                    "<td>" + tElement.cubeSize + "</td>" +
                    "<td>" + tElement.highScore + "</td>" +
                    "<td>" + tElement.scoreRate + "</td>" +
                    "</tr>" );
                }
                else{
                    $( "#users tbody" ).append( "<tr>" +
                    "<td>" + tElement.date + "</td>" +
                    "<td>" + tElement.cubeSize + "</td>" +
                    "<td>" + tElement.highScore + "</td>" +
                    "<td>" + tElement.scoreRate + "</td>" +
                    "</tr>" );
                }
                
           }
          
          $( "#dialoggames" ).empty().append(table);
          $( "#dialoggames" ).dialog( "open" );
          table.show();
          
          
          $('table tbody tr').click(function(){
                var selectedList = $( this ).text();
                selectedList = selectedList.substring(0, 8);
                
                if(!(sceneController.currentGame === selectedList)){
                    for(var i = 0; i < weeklyWordLists.length; i++){
                        var tElement = weeklyWordLists[i];
                        if(tElement.date === selectedList){

                            if (tElement.cubeSize === "4x4"){
                                sceneController.preCubeSize = 96;
                            }
                            else if (tElement.cubeSize === "5x5"){
                                sceneController.preCubeSize = 150;
                            }
                            else if (tElement.cubeSize === "6x6"){
                                sceneController.preCubeSize = 216;
                            }
                            sceneController.wordListPlay = "wordlists/" + tElement.wordList;
                            sceneController.currentGame = tElement.date;
                            break;
                        }
                    }
                    
                    if($('#check1').prop('checked')){
                        sceneController.maxWordKey = "High Word Density";
                    }
                    else
                    {
                        sceneController.maxWordKey = "Low Word Density";
                    }
                    if($('#check2').prop('checked')){
                        sceneController.cubeColorKey = "Inverse";
                    }
                    else
                    {
                        sceneController.cubeColorKey = "Normal";
                    }

                    sceneController.endAnimationActive = true;
                    
                }
                
                $( "#dialoggames" ).dialog( "close" );
                
           });
          
        });
    });
    
    
    $(function() {
        $( "#dialogWin" ).dialog({
          autoOpen: false,
          height: 300,
          width: 300,
          modal: true,
          draggable: false,
          resizable: false,
          buttons: {
            "Play Again": function() {
              sceneController.endAnimationActive = true;
              $( this ).dialog( "close" );
            },
            "Close": function() {
             
              $( this ).dialog( "close" );
            }
          },
          position: {
              my: "center",
              at: "center",
              of: container
          },
          show: {
            effect: "fade",
            duration: 200
          },
          hide: {
            effect: "fade",
            duration: 200
          }
        });
        
    });
    
    
</script>



</head>

<body onload="webGLStart();">
    
    <div id="dialogMenu" title="HINTS - SETTINGS - GAMES - INFO">
        <button id = "namebox" type="button" onclick="ButtonHints();"><img alt="HINTS - SETTINGS - GAMES - INFO" src="images/menulong.png" width="278" height="40"></button><br>
    </div>
    
    <div id="btncontainer">
        
        <label id="starbox" ><img id="starimage" src="images/blueStar40x40.png" width="30" height="30" alt="Blue" title=" 3 Stars/Letter "></label>
        <label id="scoreratebox" title=" Score Rate ">100%</label>
        <label id="scorebox" title=" Score ">99999</label>
    </div>

    
    <div id="container">
        <canvas id="WordCubed-canvas" style="border: none;" width="640" height="640"></canvas>
    </div>
    
    <div id="wordboxcontainer" title=" Find words on cube above ">
        <p id="wordbox"> </p>
    </div>
    
    
    <div id="dialog" title="Information">
        <p></p>
    </div>
    
    <div id="tabs" style="display:none">
        <ul>
          <li><a href="#tabs-1">Instructions</a></li>
          <li><a href="#tabs-2">Scoring</a></li>
          <li><a href="#tabs-3">Hints</a></li>
          <li><a href="#tabs-4">Credit</a></li>
          <li><a href="#tabs-5">Support</a></li>
        </ul>
        <div id="tabs-1">
          <p>Rotate the cube to find the words listed at the bottom of the screen. &nbsp; Once a word is found, maneuver the cube so the first and last letters of the word are visible, and then double tap the screen to freeze the cube. &nbsp; Tap the first and last letters of the word or drag your finger from one end letter to the other. &nbsp; Selecting words will score points. &nbsp; Double tap the screen again to put the cube back in free rotate mode. &nbsp; Continue to look for and select words until all words are found. &nbsp; Then find the hidden word to win the game.</p>
        </div>
        <div id="tabs-2">
          <p>Scoring</p>
        </div>
        <div id="tabs-3">
          <p>Hints</p>
        </div>
        <div id="tabs-4">
          <p>Credit</p>
        </div>
        <div id="tabs-5">
          <p>Support</p>
        </div>
    </div>
    
    <div id="dialogHints" title="Hints">
        <p></p>
    </div>
    
    <div id="dialogSettings" title="Settings">
        <p></p>
    </div>
    
    <div id="settingsformat" style="display:none">
        <input type="checkbox" id="check1"><label for="check1">High Word Density</label>
        <input type="checkbox" id="check2"><label for="check2">Inverse Colors</label>
    </div>
    
    <div id="dialoggames" title="Daily Games">
        <p></p>
    </div>
    
    <div id="weekly-games" class="ui-widget" style="display:none">
        <table id="users" class="ui-widget ui-widget-content">
          <thead>
            <tr class="ui-widget-header ">
              <th>Puzzle</th>
              <th>Cube</th>
              <th>High Score</th>
              <th>Score Rate</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
    </div>
    
    <div id="dialogWin" title="Congratulations!">
        <p></p>
    </div>
    
    
    
    
    
    
<div id="xcoord">
</div>
<div id="ycoord">
</div>
<div id="test">
</div>
<div id="xcoord2">
</div>
<div id="ycoord2">
</div>

    
    
</body>

</html>